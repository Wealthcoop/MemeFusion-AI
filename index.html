<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- SEO & App Store Metadata -->
    <title>MemeFusion AI | Next-Gen Meme Studio</title>
    <meta name="theme-color" content="#020617">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="application-name" content="MemeFusion">
    <meta name="description" content="The ultimate AI meme forge. Features Vision Captioning, Cinematic Image Fusion, and AI Voice synthesis.">

    <!-- Web App Manifest -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"MemeFusion AI","short_name":"MemeFusion","start_url":".","display":"standalone","background_color":"#020617","theme_color":"#eab308","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/2584/2584683.png","sizes":"512x512","type":"image/png"}]}'>

    <!-- Social Graphs -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="MemeFusion AI Studio">
    <meta property="og:description" content="Synthesize viral content with Gemini 2.5 AI. High-fidelity memes in seconds.">
    
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        
        :root {
            --brand-yellow: #eab308;
            --bg-slate: #020617;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            scroll-behavior: smooth;
            background-color: var(--bg-slate);
            color: white;
            overflow-x: hidden;
            user-select: none;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .bg-grid {
            background-image: radial-gradient(circle at 2px 2px, rgba(255,255,255,0.03) 1px, transparent 0);
            background-size: 32px 32px;
        }

        .glow-text {
            text-shadow: 0 0 30px rgba(234, 179, 8, 0.4);
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-12px); }
            100% { transform: translateY(0px); }
        }
        .animate-float { animation: float 6s ease-in-out infinite; }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; background: #1e293b; border-radius: 4px; }
        input[type=range]::-webkit-slider-thumb { 
            -webkit-appearance: none; 
            height: 32px; width: 32px; 
            border-radius: 50%; 
            background: var(--brand-yellow); 
            cursor: pointer; 
            margin-top: -12px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
            border: 3px solid #020617;
        }

        .meme-text {
            text-shadow: 
                2px 2px 0px #000, 
                -2px -2px 0px #000, 
                2px -2px 0px #000, 
                -2px 2px 0px #000,
                0px 4px 15px rgba(0,0,0,0.8);
        }

        .safe-pb { padding-bottom: calc(env(safe-area-inset-bottom) + 1.5rem); }
        .safe-pt { padding-top: calc(env(safe-area-inset-top) + 1rem); }
    </style>
</head>
<body class="bg-grid">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- CORE SETTINGS ---
        // 1. GENERATE A NEW KEY at aistudio.google.com
        // 2. RESTRICT IT in console.cloud.google.com to your domains
        // 3. PASTE IT BELOW
        const DEFAULT_API_KEY = "AIzaSyDEjzqipMuZ19ZsC6dfkpdxVAUIQTVDv9Q";
        // --- PRODUCTION CONSTANTS ---
        const COMMUNITY_FEED = [
            { id: 1, url: 'https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=400&h=400&fit=crop', top: 'When the code', bottom: 'Finally runs', filter: '3D Render' },
            { id: 2, url: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=400&h=400&fit=crop', top: 'Waiting for', bottom: 'The weekend', filter: 'Cyberpunk' },
            { id: 3, url: 'https://images.unsplash.com/photo-1533738363-b7f9aef128ce?w=400&h=400&fit=crop', top: 'AI took my', bottom: 'Sandwich', filter: 'Anime' },
            { id: 4, url: 'https://images.unsplash.com/photo-1543852786-1cf6624b9987?w=400&h=400&fit=crop', top: 'Sigma Cat', bottom: 'Grindset', filter: 'Retro' },
        ];

        const LAYOUTS = [
            { id: 'classic', name: 'Classic', icon: 'layout-template' },
            { id: 'top', name: 'Header', icon: 'align-start-vertical' },
            { id: 'bottom', name: 'Footer', icon: 'align-end-vertical' },
            { id: 'center', name: 'Impact', icon: 'align-center' },
        ];

        const AI_FILTERS = [
            { id: 'none', name: 'Original', icon: 'image', prompt: '' },
            { id: 'cyberpunk', name: 'Cyberpunk', icon: 'zap', prompt: 'neon-drenched aesthetic, futuristic, night city' },
            { id: 'retro', name: 'Retro', icon: 'monitor', prompt: 'vintage 80s VHS, retrowave' },
            { id: '3d', name: '3D Render', icon: 'box', prompt: 'high-end 3D render, Pixar lighting' },
            { id: 'anime', name: 'Anime', icon: 'swords', prompt: 'studio ghibli art style' },
            { id: 'oil', name: 'Oil Painting', icon: 'palette', prompt: 'classical oil painting textures' },
        ];

        // --- UTILS ---

        const haptic = (type = 'medium') => {
            if (window.navigator.vibrate) {
                const patterns = { light: 10, medium: 20, heavy: 40 };
                window.navigator.vibrate(patterns[type] || patterns.medium);
            }
        };

        const fetchWithRetry = async (url, options, maxRetries = 5) => {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return await response.json();
                    
                    const errorText = await response.text();
                    let errorMessage = errorText;
                    try {
                        const errorJson = JSON.parse(errorText);
                        errorMessage = errorJson.error?.message || errorText;
                    } catch (e) {}

                    if (response.status === 403) {
                        throw new Error(`API Restricted: Ensure your Key allows requests from ${window.location.hostname}. Check Google Cloud Console Referrers.`);
                    }

                    if (response.status === 429) {
                        throw new Error(`Quota Reached: The AI is busy. Please wait 60 seconds.`);
                    }

                    throw new Error(`API Error (${response.status}): ${errorMessage.substring(0, 100)}...`);
                } catch (err) {
                    // Only retry on quota or network issues
                    if (!err.message.includes("Quota") && !err.message.includes("Failed to fetch")) {
                        throw err;
                    }
                    if (i === maxRetries - 1) throw err;
                    const delay = Math.pow(2, i) * 1000;
                    await new Promise(res => setTimeout(res, delay));
                }
            }
        };

        const Icon = ({ name, size = 24, className = "" }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (window.lucide && containerRef.current) {
                    containerRef.current.innerHTML = `<i data-lucide="${name}" style="width: ${size}px; height: ${size}px;" class="${className}"></i>`;
                    window.lucide.createIcons({ root: containerRef.current });
                }
            }, [name, size, className]);
            return <span ref={containerRef} className="inline-flex items-center justify-center"></span>;
        };

        function pcmToWav(pcmData, sampleRate) {
            const buffer = new ArrayBuffer(44 + pcmData.length);
            const view = new DataView(buffer);
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i));
            };
            writeString(0, 'RIFF');
            view.setUint32(4, 36 + pcmData.length, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, pcmData.length, true);
            new Uint8Array(buffer, 44).set(new Uint8Array(pcmData));
            return new Blob([buffer], { type: 'audio/wav' });
        }

        // --- COMPONENTS ---

        function App() {
            const [view, setView] = useState('landing');
            const [apiKey, setApiKey] = useState(DEFAULT_API_KEY || localStorage.getItem('MF_KEY') || "");
            const [image, setImage] = useState(null);
            const [topText, setTopText] = useState("");
            const [bottomText, setBottomText] = useState("");
            const [fontSize, setFontSize] = useState(36);
            const [textColor, setTextColor] = useState('#ffffff');
            const [layout, setLayout] = useState('classic');
            const [selectedFilter, setSelectedFilter] = useState('none');
            const [loading, setLoading] = useState(false);
            const [cooldown, setCooldown] = useState(false);
            const [visionLoading, setVisionLoading] = useState(false);
            const [voiceLoading, setVoiceLoading] = useState(false);
            const [fusedImage, setFusedImage] = useState(null);
            const [history, setHistory] = useState([]);
            const [error, setError] = useState(null);
            const [isOnline, setIsOnline] = useState(window.navigator.onLine);

            useEffect(() => {
                const handleOnline = () => setIsOnline(true);
                const handleOffline = () => setIsOnline(false);
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);

            const triggerCooldown = () => {
                setCooldown(true);
                setTimeout(() => setCooldown(false), 5000);
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    haptic('light');
                    const reader = new FileReader();
                    reader.onload = (ev) => { setImage(ev.target.result); setFusedImage(null); setError(null); };
                    reader.readAsDataURL(file);
                }
            };

            const suggestCaptions = async () => {
                if (!image || visionLoading || !isOnline || cooldown) return;
                if (!apiKey) { setError("API Key Missing. Add your key to the code to use AI features."); return; }
                haptic('light');
                setVisionLoading(true);
                setError(null);
                const base64Data = image.split(',')[1];
                try {
                    const res = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: "Suggest a humorous, short meme caption for this. JSON: {top: string, bottom: string}." }, { inlineData: { mimeType: "image/png", data: base64Data } }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const suggested = JSON.parse(res.candidates[0].content.parts[0].text);
                    setTopText(suggested.top.toUpperCase());
                    setBottomText(suggested.bottom.toUpperCase());
                    haptic('medium');
                    triggerCooldown();
                } catch (e) { setError(e.message); } finally { setVisionLoading(false); }
            };

            const fuseWithAI = async () => {
                if (!image || !isOnline || cooldown) return;
                if (!apiKey) { setError("API Key Missing."); return; }
                haptic('medium');
                setLoading(true);
                setError(null);
                const filter = AI_FILTERS.find(f => f.id === selectedFilter);
                const base64Data = image.split(',')[1];
                try {
                    const res = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `High-fidelity digital art based on this image. Text: "${topText} ${bottomText}". Aesthetic: ${filter.prompt}. Cinematic.` }, { inlineData: { mimeType: "image/png", data: base64Data } }] }],
                            generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }
                        })
                    });
                    const b64 = res.candidates[0].content.parts.find(p => p.inlineData).inlineData.data;
                    const newUrl = `data:image/png;base64,${b64}`;
                    setFusedImage(newUrl);
                    setHistory(prev => [{ id: Date.now(), url: newUrl, top: topText, bottom: bottomText }, ...prev].slice(0, 5));
                    haptic('heavy');
                    triggerCooldown();
                } catch (e) { setError(e.message); } finally { setLoading(false); }
            };

            const speakMeme = async () => {
                if (!topText && !bottomText || !isOnline || cooldown) return;
                haptic('light');
                setVoiceLoading(true);
                try {
                    const res = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Say with extreme viral energy: ${topText}. ${bottomText}` }] }],
                            generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Puck" } } } }
                        })
                    });
                    const audioPart = res.candidates[0].content.parts[0].inlineData;
                    const rate = parseInt(audioPart.mimeType.split('rate=')[1]) || 24000;
                    const pcm = new Uint8Array(atob(audioPart.data).split("").map(c => c.charCodeAt(0)));
                    new Audio(URL.createObjectURL(pcmToWav(pcm, rate))).play();
                    triggerCooldown();
                } catch (e) { setError(e.message); } finally { setVoiceLoading(false); }
            };

            const handleShare = async () => {
                haptic('light');
                const target = fusedImage || image;
                if (!target) return;
                if (navigator.share) {
                    try {
                        const res = await fetch(target);
                        const blob = await res.blob();
                        const file = new File([blob], 'memefusion.png', { type: 'image/png' });
                        await navigator.share({ files: [file], title: 'MemeFusion AI' });
                    } catch (e) {}
                } else {
                    const l=document.createElement('a'); l.href=target; l.download='meme.png'; l.click();
                }
            };

            if (view === 'landing') {
                return (
                    <div className="min-h-screen flex flex-col items-center">
                        <nav className="w-full p-6 flex justify-between items-center max-w-6xl z-10 safe-pt">
                            <div className="flex items-center gap-2">
                                <Icon name="sparkles" size={24} className="text-yellow-500" />
                                <span className="text-xl font-black italic uppercase">MemeFusion</span>
                            </div>
                            <button onClick={() => setView('editor')} className="bg-yellow-500 text-slate-950 px-6 py-2 rounded-full text-xs font-black uppercase">Launch Studio</button>
                        </nav>
                        <main className="flex-1 flex flex-col items-center justify-center text-center px-6 py-24 z-10">
                            <h1 className="text-7xl md:text-9xl font-black italic uppercase tracking-tighter mb-8 leading-[0.8] glow-text">Next-Gen <br/> <span className="text-yellow-500">Meme Studio</span></h1>
                            <p className="text-slate-400 text-lg md:text-2xl max-w-2xl mb-12 font-medium">Create, Fuse, and Narrate with AI. Synthesis Pro v2.5.0</p>
                            <button onClick={() => setView('editor')} className="px-12 py-6 bg-yellow-500 text-slate-950 rounded-full font-black uppercase italic tracking-tighter text-2xl active:scale-95 transition-all shadow-2xl shadow-yellow-500/20">Enter Forge</button>
                        </main>
                        {!isOnline && <div className="fixed bottom-0 inset-x-0 bg-red-500 text-white text-[10px] font-black py-2 text-center">OFFLINE MODE - AI FEATURES DISABLED</div>}
                    </div>
                );
            }

            return (
                <div key="editor" className="min-h-screen bg-slate-900 text-white flex flex-col selection:bg-yellow-500 selection:text-slate-950">
                    <header className="p-6 pt-12 flex justify-between items-center bg-slate-900/50 backdrop-blur-xl border-b border-white/5 sticky top-0 z-40 safe-pt">
                        <button onClick={() => setView('landing')} className="flex items-center gap-2 group">
                            <Icon name="chevron-left" size={20} className="text-slate-500 group-hover:text-white" />
                            <h1 className="text-xl font-black italic">MemeFusion</h1>
                        </button>
                        <div className={`px-4 py-1 rounded-full text-[10px] font-black shadow-lg transition-colors ${cooldown ? 'bg-red-500 text-white animate-pulse' : 'bg-yellow-500 text-slate-950'}`}>
                            {cooldown ? 'RECHARGING...' : 'PRO ACTIVE'}
                        </div>
                    </header>

                    <main className="flex-1 p-6 space-y-8 max-w-2xl mx-auto w-full pb-32 overflow-y-auto no-scrollbar">
                        {error && (
                            <div className="bg-red-500/10 border border-red-500/50 p-6 rounded-3xl text-red-500 text-xs font-bold text-center flex flex-col items-center justify-center gap-3">
                                <div className="flex items-center gap-2 font-black uppercase"><Icon name="alert-triangle" size={14} /> Security Alert</div>
                                <div className="opacity-80 leading-relaxed">{error}</div>
                                {error.includes("Restricted") && (
                                    <div className="mt-2 p-3 bg-white/5 rounded-xl text-white font-normal text-left text-[10px]">
                                        <p className="mb-1 font-bold">Quick Fix:</p>
                                        1. Go to Google Cloud Credentials.<br/>
                                        2. Click your API Key.<br/>
                                        3. Add <b>{window.location.hostname}/*</b> to Referrers.<br/>
                                        4. Wait 5 minutes for sync.
                                    </div>
                                )}
                            </div>
                        )}

                        <div className="aspect-square bg-slate-800 rounded-[3rem] border border-white/5 flex flex-col items-center justify-center relative overflow-hidden shadow-2xl group active:scale-[0.98] transition-transform">
                            {loading && (
                                <div className="absolute inset-0 z-30 bg-slate-950/90 flex flex-col items-center justify-center space-y-4">
                                    <div className="w-16 h-16 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin"></div>
                                    <p className="font-black uppercase tracking-widest text-[10px] text-yellow-500">AI Synthesizing...</p>
                                </div>
                            )}

                            {!image ? (
                                <div className="text-center space-y-4">
                                    <div className="w-20 h-20 bg-slate-700/50 rounded-full flex items-center justify-center mx-auto border border-white/10 group-hover:scale-110 transition-transform"><Icon name="upload" className="text-slate-500" /></div>
                                    <p className="text-[10px] font-black uppercase tracking-widest text-slate-500">Tap to upload base</p>
                                </div>
                            ) : (
                                <div className="w-full h-full relative">
                                    <img src={fusedImage || image} className="w-full h-full object-cover" />
                                    {!fusedImage && (
                                        <div className={`absolute inset-0 p-8 flex flex-col pointer-events-none ${layout === 'classic' ? 'justify-between' : layout === 'top' ? 'justify-start' : layout === 'bottom' ? 'justify-end' : 'justify-center'}`}>
                                            <h2 className="text-center font-black uppercase break-words leading-none meme-text" style={{ fontSize: `${fontSize}px`, color: textColor }}>{topText}</h2>
                                            {(layout === 'classic' || layout === 'bottom') && <h2 className="text-center font-black uppercase break-words leading-none meme-text" style={{ fontSize: `${fontSize}px`, color: textColor }}>{bottomText}</h2>}
                                        </div>
                                    )}
                                </div>
                            )}
                            {!loading && <input type="file" accept="image/*" className="absolute inset-0 opacity-0 cursor-pointer" onChange={handleFileUpload} />}
                        </div>

                        <div className="space-y-6">
                            <div className="bg-slate-800/30 p-2 rounded-[2rem] border border-white/5 flex gap-1 shadow-lg">
                                {LAYOUTS.map(L => (
                                    <button key={L.id} onClick={() => { haptic('light'); setLayout(L.id); }} className={`flex-1 py-4 rounded-3xl flex flex-col items-center gap-1 transition-all ${layout === L.id ? 'bg-yellow-500 text-slate-950 font-black' : 'text-slate-500 opacity-60'}`}>
                                        <Icon name={L.icon} size={18} /><span className="text-[9px] uppercase font-bold">{L.name}</span>
                                    </button>
                                ))}
                            </div>

                            <div className="space-y-4 relative">
                                <button onClick={suggestCaptions} disabled={visionLoading || !image || !isOnline || cooldown} className={`absolute -top-12 right-0 flex items-center gap-2 px-4 py-2 rounded-full text-[10px] font-black uppercase transition-all shadow-xl ${visionLoading || cooldown ? 'bg-slate-800 text-slate-600' : 'bg-indigo-600 text-white active:scale-95'}`}>
                                    {visionLoading ? <div className="w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> : <Icon name="wand-2" size={14} />} AI Vision
                                </button>
                                <div className="bg-slate-800/50 p-5 rounded-[2rem] border border-white/5 shadow-inner">
                                    <input placeholder="TOP TEXT" className="bg-transparent w-full text-center font-black uppercase outline-none placeholder:text-slate-700 text-xl" value={topText} onChange={e => setTopText(e.target.value)} />
                                </div>
                                <div className="bg-slate-800/50 p-5 rounded-[2rem] border border-white/5 shadow-inner">
                                    <input placeholder="BOTTOM TEXT" className="bg-transparent w-full text-center font-black uppercase outline-none placeholder:text-slate-700 text-xl" value={bottomText} onChange={e => setBottomText(e.target.value)} />
                                </div>
                            </div>

                            <div className="flex gap-3 overflow-x-auto no-scrollbar pb-2 px-1">
                                {AI_FILTERS.map(F => (
                                    <button key={F.id} onClick={() => { haptic('light'); setSelectedFilter(F.id); }} className={`flex-shrink-0 px-6 py-4 rounded-[1.5rem] border transition-all flex items-center gap-3 shadow-md ${selectedFilter === F.id ? 'bg-yellow-500/20 border-yellow-500 text-yellow-500 shadow-yellow-500/10' : 'bg-slate-800/30 border-white/5 text-slate-400'}`}>
                                        <Icon name={F.icon} size={16} /><span className="text-[11px] font-black uppercase">{F.name}</span>
                                    </button>
                                ))}
                            </div>

                            <div className="bg-slate-800/30 p-8 rounded-[2.5rem] border border-white/5 space-y-6 shadow-lg">
                                <div className="flex justify-between items-center"><label className="text-xs font-black text-slate-500 uppercase tracking-[0.2em]">Font Scale</label><span className="text-[10px] font-black text-yellow-500">{fontSize}PX</span></div>
                                <input type="range" min="12" max="100" value={fontSize} onChange={e => setFontSize(parseInt(e.target.value))} className="w-full" />
                                <div className="flex gap-3 overflow-x-auto no-scrollbar pb-2">
                                    {PRESET_COLORS.map(c => <button key={c.value} onClick={() => { haptic('light'); setTextColor(c.value); }} className={`w-10 h-10 rounded-full border-2 transition-transform active:scale-90 ${textColor === c.value ? 'border-yellow-500 scale-110' : 'border-transparent opacity-60'}`} style={{ backgroundColor: c.value }} />)}
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 gap-4 pt-6 safe-pb">
                            <button onClick={fuseWithAI} disabled={loading || !image || !isOnline || cooldown} className={`w-full h-24 rounded-[2.5rem] font-black uppercase tracking-tighter transition-all shadow-2xl flex flex-col items-center justify-center gap-1 ${loading || !image || !isOnline || cooldown ? 'bg-slate-800 text-slate-500' : 'bg-yellow-500 text-slate-950 active:scale-95'}`}>
                                <div className="flex items-center gap-2"><Icon name="zap" size={24} /><span className="text-2xl italic uppercase tracking-tighter">Fuse with AI</span></div>
                                <span className="text-[10px] font-black opacity-70 tracking-widest uppercase">{cooldown ? 'Engine Syncing...' : 'Engine v2.5.0 Live'}</span>
                            </button>
                            <div className="grid grid-cols-3 gap-4">
                                <button onClick={speakMeme} disabled={voiceLoading || !isOnline || cooldown} className="h-16 rounded-3xl glass-panel flex items-center justify-center active:scale-95 transition-all shadow-xl disabled:opacity-30">
                                    {voiceLoading ? <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> : <Icon name="volume-2" size={24} />}
                                </button>
                                <button onClick={() => { haptic('light'); const l=document.createElement('a'); l.href=fusedImage||image; l.download='meme.png'; l.click();}} className="h-16 rounded-3xl glass-panel flex items-center justify-center active:scale-95 transition-all shadow-xl"><Icon name="download" size={24} /></button>
                                <button onClick={handleShare} className="h-16 rounded-3xl glass-panel flex items-center justify-center active:scale-95 transition-all shadow-xl"><Icon name="share-2" size={24} /></button>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
