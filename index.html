842
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
      <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- SEO & App Store Metadata -->
    <title>MemeFusion AI | Next-Gen Meme Studio</title>
    <meta name="theme-color" content="#020617">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="application-name" content="MemeFusion">
    <meta name="description" content="The ultimate AI meme forge. Features Vision Captioning, Cinematic Image Fusion, and AI Voice synthesis.">

    <!-- Web App Manifest -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"MemeFusion AI","short_name":"MemeFusion","start_url":".","display":"standalone","background_color":"#020617","theme_color":"#eab308","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/2584/2584683.png","sizes":"512x512","type":"image/png"}]}'>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        :root { --brand-yellow: #eab308; --bg-slate: #020617; }
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; scroll-behavior: smooth; background-color: var(--bg-slate); color: white; overflow-x: hidden; user-select: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .bg-grid { background-image: radial-gradient(circle at 2px 2px, rgba(255,255,255,0.03) 1px, transparent 0); background-size: 32px 32px; }
        .glow-text { text-shadow: 0 0 30px rgba(234, 179, 8, 0.4); }
        .glass-panel { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; background: #1e293b; border-radius: 4px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 32px; width: 32px; border-radius: 50%; background: var(--brand-yellow); cursor: pointer; margin-top: -12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6); border: 3px solid #020617; }
        .meme-text { text-shadow: 2px 2px 0px #000, -2px -2px 0px #000, 2px -2px 0px #000, -2px 2px 0px #000, 0px 4px 15px rgba(0,0,0,0.8); }
        .safe-pb { padding-bottom: calc(env(safe-area-inset-bottom) + 1.5rem); }
        .safe-pt { padding-top: calc(env(safe-area-inset-top) + 1rem); }
    </style>
</head>
<body class="bg-grid">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

API KEY (Restricted to memefusion.aeye.monster and wealthcoop.github.io)
        const DEFAULT_API_KEY = "AIzaSyDLEkneMhCeUxLDkD8VXSV_RhiXK4rQbnw";

        const COMMUNITY_FEED = [
            { id: 1, url: 'https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=400&h=400&fit=crop', top: 'When the code', bottom: 'Finally runs', filter: '3D Render' },
            { id: 2, url: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=400&h=400&fit=crop', top: 'Waiting for', bottom: 'The weekend', filter: 'Cyberpunk' },
            { id: 3, url: 'https://images.unsplash.com/photo-1533738363-b7f9aef128ce?w=400&h=400&fit=crop', top: 'AI took my', bottom: 'Sandwich', filter: 'Anime' },
            { id: 4, url: 'https://images.unsplash.com/photo-1543852786-1cf6624b9987?w=400&h=400&fit=crop', top: 'Sigma Cat', bottom: 'Grindset', filter: 'Retro' },
        ];

        const STARTER_TEMPLATES = [
            { id: 'cat', name: 'Viral Cat', url: 'https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=400&h=400&fit=crop' },
            { id: 'office', name: 'The Office', url: 'https://images.unsplash.com/photo-1516733725897-1aa73b87c8e8?w=400&h=400&fit=crop' },
            { id: 'galaxy', name: 'Galaxy', url: 'https://images.unsplash.com/photo-1446776811953-b23d57bd21aa?w=400&h=400&fit=crop' },
            { id: 'neon', name: 'Retro Vibes', url: 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?w=400&h=400&fit=crop' },
        ];

        const PRESET_COLORS = [
            { name: 'White', value: '#ffffff' },
            { name: 'Yellow', value: '#eab308' },
            { name: 'Red', value: '#ef4444' },
            { name: 'Cyan', value: '#06b6d4' },
            { name: 'Green', value: '#22c55e' },
            { name: 'Pink', value: '#ec4899' },
        ];

        const LAYOUTS = [
            { id: 'classic', name: 'Classic', icon: 'layout-template' },
            { id: 'top', name: 'Header', icon: 'align-start-vertical' },
            { id: 'bottom', name: 'Footer', icon: 'align-end-vertical' },
            { id: 'center', name: 'Impact', icon: 'align-center' },
        ];

        const AI_FILTERS = [
            { id: 'none', name: 'Original', icon: 'image', prompt: '' },
            { id: 'anime', name: 'Anime', icon: 'swords', prompt: 'High-definition Shonen anime illustration, sharp cel-shading, vibrant colors, iconic expressive manga eyes, professional line art, Studio Ghibli meets Makoto Shinkai aesthetic' },
            { id: 'sketch', name: 'Sketch', icon: 'pencil', prompt: 'Masterful hand-drawn graphite pencil sketch, artistic cross-hatching, realistic charcoal shading, fine detailed pencil strokes, textured white paper background' },
            { id: 'cyberpunk', name: 'Cyberpunk', icon: 'zap', prompt: 'Dramatically overhaul this image into a gritty Cyberpunk Masterpiece. Replace human skin with visible cybernetic tech-plating and robotic circuits. Subject must wear glowing neon-lit futuristic armor. Heavy rain-slicked tech-noir city lighting with high-contrast electric blue and hot pink hues' },
            { id: '3d', name: '3D Render', icon: 'box', prompt: 'Completely recreate this scene as a high-end 3D CGI animation still. Transform the subject into a stylized 3D vinyl character with smooth plastic skin textures. High-poly Disney-Pixar film aesthetic, volumetric soft rim lighting, subsurface scattering, extreme depth-of-field, rendered in Octane for Unreal Engine 5' },
            { id: 'retro', name: 'Retro VHS', icon: 'monitor', prompt: '80s retro synthwave aesthetic, dramatic VHS glitch effects, chromatic aberration, heavy scanline distortion, vintage saturated neon colors' },
            { id: 'oil', name: 'Oil Painting', icon: 'palette', prompt: 'Thick impasto oil painting, heavy visible palette knife strokes, classical museum masterpiece texture, rich blended oil colors, canvas grain' },
        ];

        const fetchWithRetry = async (url, options, maxRetries = 3) => {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    const data = await response.json();
                    
                    if (response.ok) return data;
                    
                    const errorMessage = data.error?.message || "Unknown error";
                    
                    if (response.status === 400) {
                        if (errorMessage.toLowerCase().includes("safety") || JSON.stringify(data).includes("SAFETY")) {
                            throw new Error("Safety Block: The AI considered this image/text too sensitive.");
                        }
                        if (errorMessage.toLowerCase().includes("large") || errorMessage.toLowerCase().includes("limit")) {
                            throw new Error("File too large. Try taking a screenshot of the photo instead.");
                        }
                    }
                    
                    if (response.status === 403 || response.status === 401) {
                        throw new Error("API Expired! Please generate a NEW key and ensure Website Referrers are set properly in Google Cloud.");
                    }

                    if (response.status === 429) throw new Error("Quota Reached. Please wait 60 seconds.");
                    
                    throw new Error(`API ${response.status}: ${errorMessage}`);
                } catch (err) {
                    if (i === maxRetries - 1 || err.message.includes("Block") || err.message.includes("Expired") || err.message.includes("Quota")) throw err;
                    await new Promise(res => setTimeout(res, 2000));
                }
            }
        };

        const Icon = ({ name, size = 24, className = "" }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (window.lucide && containerRef.current) {
                    containerRef.current.innerHTML = `<i data-lucide="${name}" style="width: ${size}px; height: ${size}px;" class="${className}"></i>`;
                    window.lucide.createIcons({ root: containerRef.current });
                }
            }, [name, size, className]);
            return <span ref={containerRef} className="inline-flex items-center justify-center"></span>;
        };

        function App() {
            const [view, setView] = useState('landing');
            const [image, setImage] = useState(null);
            const [topText, setTopText] = useState("");
            const [bottomText, setBottomText] = useState("");
            const [fontSize, setFontSize] = useState(36);
            const [textColor, setTextColor] = useState('#ffffff');
            const [layout, setLayout] = useState('classic');
            const [selectedFilter, setSelectedFilter] = useState('none');
            const [loading, setLoading] = useState(false);
            const [cooldown, setCooldown] = useState(false);
            const [visionLoading, setVisionLoading] = useState(false);
            const [fusedImage, setFusedImage] = useState(null);
            const [error, setError] = useState(null);

            const triggerCooldown = () => { setCooldown(true); setTimeout(() => setCooldown(false), 8000); };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => { setImage(ev.target.result); setFusedImage(null); setError(null); };
                    reader.readAsDataURL(file);
                }
            };

            const suggestCaptions = async () => {
                if (!image || visionLoading || cooldown) return;
                if (!DEFAULT_API_KEY) { setError("API Key Missing. Renew your key in the code."); return; }
                setVisionLoading(true); setError(null);
                const base64Data = image.split(',')[1];
                try {
                    const data = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${DEFAULT_API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: "Suggest a humorous viral meme caption. JSON: {top, bottom}." }, { inlineData: { mimeType: "image/png", data: base64Data } }] }], generationConfig: { responseMimeType: "application/json" } })
                    });
                    const suggested = JSON.parse(data.candidates[0].content.parts[0].text);
                    setTopText(suggested.top.toUpperCase()); setBottomText(suggested.bottom.toUpperCase());
                    triggerCooldown();
                } catch (e) { setError(e.message); } finally { setVisionLoading(false); }
            };

            const fuseWithAI = async () => {
                if (!image || cooldown) return;
                if (!DEFAULT_API_KEY) { setError("API Key Missing. Renew your key in the code."); return; }
                setLoading(true); setError(null);
                const filter = AI_FILTERS.find(f => f.id === selectedFilter);
                const base64Data = image.split(',')[1];
                try {
                    const data = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${DEFAULT_API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            contents: [{ 
                                parts: [
                                    { text: `TOTAL ARTISTIC OVERHAUL DIRECTIVE: Completely re-build this image from scratch into the following professional art style: ${filter.prompt}. CORE RULE: You must maintain the exact pose, body orientation, and facial silhouette of the original subject so it is recognizable. Replace all real-world materials with stylistic ones. Subject context: "${topText} ${bottomText}". Studio quality 4k render.` }, 
                                    { inlineData: { mimeType: "image/png", data: base64Data } }
                                ] 
                            }], 
                            generationConfig: { responseModalities: ['TEXT', 'IMAGE'] } 
                        })
                    });

                    const candidate = data.candidates?.[0];
                    if (candidate?.finishReason === "SAFETY") {
                        throw new Error("Safety Block: The AI refused to generate this specific visual.");
                    }

                    const imagePart = candidate?.content?.parts?.find(p => p.inlineData);
                    if (!imagePart) {
                        throw new Error("Fusion Failed: No image returned. Try different text.");
                    }

                    setFusedImage(`data:image/png;base64,${imagePart.inlineData.data}`);
                    triggerCooldown();
                } catch (e) { setError(e.message); } finally { setLoading(false); }
            };

            if (view === 'landing') return (
                <div className="min-h-screen flex flex-col items-center">
                    <nav className="w-full p-6 flex justify-between items-center z-10 safe-pt">
                        <div className="flex items-center gap-2"><Icon name="sparkles" className="text-yellow-500" /><span className="text-xl font-black italic uppercase">MemeFusion</span></div>
                        <button onClick={() => setView('editor')} className="bg-yellow-500 text-slate-950 px-6 py-2 rounded-full font-black uppercase text-xs">Enter Forge</button>
                    </nav>
                    <main className="flex-1 flex flex-col items-center justify-center text-center px-6 py-24 z-10">
                        <h1 className="text-7xl md:text-9xl font-black italic uppercase tracking-tighter mb-8 glow-text">Meme <span className="text-yellow-500">Forge</span></h1>
                        <p className="text-slate-400 text-lg md:text-2xl max-w-2xl mb-12 font-medium">Create viral content with AI. Cinematic Fusion Pro.</p>
                        <button onClick={() => setView('editor')} className="px-12 py-6 bg-yellow-500 text-slate-950 rounded-full font-black uppercase italic tracking-tighter text-2xl shadow-2xl">Launch Studio</button>
                    </main>
                </div>
            );

            return (
                <div key="editor" className="min-h-screen bg-slate-900 text-white flex flex-col selection:bg-yellow-500 selection:text-slate-950">
                    <header className="p-6 pt-12 flex justify-between items-center bg-slate-900/50 backdrop-blur-xl border-b border-white/5 sticky top-0 z-40 safe-pt">
                        <button onClick={() => setView('landing')} className="flex items-center gap-2 group"><Icon name="chevron-left" className="text-slate-500" /><h1 className="text-xl font-black italic">Studio</h1></button>
                        <div className={`px-4 py-1 rounded-full text-[10px] font-black shadow-lg transition-colors ${cooldown ? 'bg-red-500 animate-pulse' : 'bg-yellow-500 text-slate-950'}`}>
                            {cooldown ? 'RECHARGING' : 'PRO ACTIVE'}
                        </div>
                    </header>

                    <main className="flex-1 p-6 space-y-8 max-w-2xl mx-auto w-full pb-32 overflow-y-auto no-scrollbar">
                        {error && (
                            <div className="bg-red-500/10 border border-red-500/50 p-6 rounded-3xl text-red-500 text-xs font-bold text-center flex flex-col items-center justify-center gap-3 animate-pulse">
                                <div className="flex items-center gap-2 font-black uppercase"><Icon name="alert-triangle" size={14} /> AI Engine Blocked</div>
                                <div className="opacity-80 leading-relaxed">{error}</div>
                                {error.includes("Expired") && <p className="text-[10px] text-white bg-red-500 px-3 py-1 rounded-full">New Key Required</p>}
                            </div>
                        )}

                        <div className="aspect-square bg-slate-800 rounded-[3rem] border border-white/5 flex flex-col items-center justify-center relative overflow-hidden shadow-2xl group active:scale-[0.98] transition-transform">
                            {loading && <div className="absolute inset-0 z-30 bg-slate-950/90 flex flex-col items-center justify-center space-y-4"><div className="w-16 h-16 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin"></div><p className="font-black uppercase text-xs text-yellow-500">Synthesizing Style...</p></div>}
                            {!image ? <div className="text-center space-y-4"><div className="w-20 h-20 bg-slate-700/50 rounded-full flex items-center justify-center mx-auto border border-white/10 active:scale-110 transition-transform"><Icon name="upload" className="text-slate-500" /></div><p className="text-[10px] font-black uppercase tracking-widest text-slate-500">Tap to upload base</p></div> : 
                            <div className="w-full h-full relative"><img src={fusedImage || image} className="w-full h-full object-cover" />{!fusedImage && <div className={`absolute inset-0 p-8 flex flex-col pointer-events-none ${layout === 'classic' ? 'justify-between' : layout === 'top' ? 'justify-start' : layout === 'bottom' ? 'justify-end' : 'justify-center'}`}><h2 className="text-center font-black uppercase break-words leading-none meme-text" style={{ fontSize: `${fontSize}px`, color: textColor }}>{topText}</h2>{(layout === 'classic' || layout === 'bottom') && <h2 className="text-center font-black uppercase break-words leading-none meme-text" style={{ fontSize: `${fontSize}px`, color: textColor }}>{bottomText}</h2>}</div>}</div>}
                            {!loading && <input type="file" accept="image/*" className="absolute inset-0 opacity-0 cursor-pointer" onChange={handleFileUpload} />}
                        </div>

                        <div className="flex gap-4 overflow-x-auto no-scrollbar py-2">
                            {STARTER_TEMPLATES.map(t => <button key={t.id} onClick={() => { setImage(t.url); setError(null); }} className="flex-shrink-0 w-24 h-24 rounded-[1.5rem] overflow-hidden border border-white/10 active:scale-90 transition-transform shadow-xl"><img src={t.url} className="w-full h-full object-cover" /></button>)}
                        </div>

                        <div className="space-y-6">
                            <div className="bg-slate-800/30 p-2 rounded-[2rem] border border-white/5 flex gap-1 shadow-lg">
                                {LAYOUTS.map(L => <button key={L.id} onClick={() => setLayout(L.id)} className={`flex-1 py-4 rounded-3xl flex flex-col items-center gap-1 transition-all ${layout === L.id ? 'bg-yellow-500 text-slate-950 font-black' : 'text-slate-500 opacity-60'}`}><Icon name={L.icon} size={18} /><span className="text-[9px] uppercase font-bold">{L.name}</span></button>)}
                            </div>
                            <div className="space-y-4 relative">
                                <button onClick={suggestCaptions} disabled={visionLoading || !image || cooldown} className={`absolute -top-12 right-0 flex items-center gap-2 px-4 py-2 rounded-full text-[10px] font-black uppercase transition-all shadow-xl ${visionLoading || cooldown ? 'bg-slate-800 text-slate-600' : 'bg-indigo-600 text-white active:scale-95'}`}>{visionLoading ? "..." : <Icon name="wand-2" size={14} />} AI Vision</button>
                                <div className="bg-slate-800/50 p-4 rounded-[2rem] border border-white/5 shadow-inner"><input placeholder="TOP TEXT" className="bg-transparent w-full text-center font-black uppercase outline-none text-xl" value={topText} onChange={e => setTopText(e.target.value)} /></div>
                                <div className="bg-slate-800/50 p-4 rounded-[2rem] border border-white/5 shadow-inner"><input placeholder="BOTTOM TEXT" className="bg-transparent w-full text-center font-black uppercase outline-none text-xl" value={bottomText} onChange={e => setBottomText(e.target.value)} /></div>
                            </div>
                            <div className="flex gap-3 overflow-x-auto no-scrollbar pb-2 px-1">
                                {AI_FILTERS.map(F => <button key={F.id} onClick={() => setSelectedFilter(F.id)} className={`flex-shrink-0 px-6 py-4 rounded-[1.5rem] border transition-all flex items-center gap-3 shadow-md ${selectedFilter === F.id ? 'bg-yellow-500/20 border-yellow-500 text-yellow-500 shadow-yellow-500/10' : 'bg-slate-800/30 border-white/5 text-slate-400'}`}><Icon name={F.icon} size={16} /><span className="text-[11px] font-black uppercase">{F.name}</span></button>)}
                            </div>
                            <div className="bg-slate-800/30 p-8 rounded-[2.5rem] border border-white/5 space-y-6 shadow-lg">
                                <input type="range" min="12" max="100" value={fontSize} onChange={e => setFontSize(parseInt(e.target.value))} className="w-full" />
                                <div className="flex gap-3 overflow-x-auto no-scrollbar pb-2">{PRESET_COLORS.map(c => <button key={c.value} onClick={() => setTextColor(c.value)} className={`w-10 h-10 rounded-full border-2 transition-transform active:scale-90 ${textColor === c.value ? 'border-yellow-500 scale-110' : 'border-transparent opacity-60'}`} style={{ backgroundColor: c.value }} />)}</div>
                            </div>
                        </div>

                        <button onClick={fuseWithAI} disabled={loading || !image || cooldown} className={`w-full h-24 rounded-[2.5rem] font-black uppercase tracking-tighter transition-all shadow-2xl flex flex-col items-center justify-center ${loading || !image || cooldown ? 'bg-slate-800 text-slate-500' : 'bg-yellow-500 text-slate-950 active:scale-95'}`}>
                            <div className="flex items-center gap-2"><Icon name="zap" size={24} /><span>Fuse with AI</span></div>
                            <span className="text-[10px] font-black opacity-70">{cooldown ? 'RECHARGING' : 'Engine Live'}</span>
                        </button>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
